<tool id="lca" name="lowest common ancestor">
<description>Find lowest common ancestor</description>
<command interpreter="bash">
lca.sh
$input<!--blastoutput file input-->
$output
$bitscore
$identity
$coverage
$setting_mode.best_hit
#if $setting_mode.best_hit == "yes"
	$setting_mode.tophitid
	$setting_mode.tophitcoverage
#end if
$filterhits
$filterlcahits
$minbitscore
$filtersource
</command>
	<macros>
	<macro name="best_hit_params">
		<param name="tophitid" type="float" label="Identity treshold" value="100" min="1" max="100"/>
		<param name="tophitcoverage" type="float" label="Query coverage treshold"  value="100" min="1" max="100"/>
	</macro>
	</macros>
<inputs>
<param format="tabular" name="input" type="data" label="BLAST output file"/>
<param name="bitscore" type="float" label="Top bitscore percentage cutoff"  value="8" min="1" max="100"/>
<param name="minbitscore" type="integer" label="Minimum bitscore"  value="100" min="1" max="1000"/>
<param name="identity" type="float" label="Minimum identity"  value="80" min="1" max="100"/>
<param name="coverage" type="float" label="Minimum coverage"  value="70" min="1" max="100"/>
	<conditional name="setting_mode">
					<param name="best_hit" type="select" multiple="false" label="Settings mode">
						<option value="yes" selected="true">Output the best hit as species if it is above the choosen treshold</option>
						<option value="no">Check lca on all hits</option>
					</param>
					<when value="yes">
						<expand macro="best_hit_params"/>
					</when>
				</conditional>
	<param name="filterhits" type="text" label="Dont use hits containing this taxonomy:" help="Comma seperated"  value="environmental"/>
    <param name="filterlcahits" type="text" label="Ignore rank when containing:" help="Comma seperated" value="unknown"/>
	<param name="filtersource" type="select" multiple="true" label="Dont use hits with taxonomy from:">
            <option value="BOLD" label="BOLD">BOLD</option>
            <option value="private_BOLD">private_BOLD</option>
            <option value="Genbank">Genbank</option>
        </param>
</inputs>

	
<outputs>
	<data format="tabular" name="output" label="$input.display_name lca" />
</outputs>
<tests>
<test>
<param name="test_input" value="test_input.txt"/>
<output name="test_outout" file="test_output.txt"/>
</test>
</tests>
<help>
Find lca from blast output
</help>
</tool>
